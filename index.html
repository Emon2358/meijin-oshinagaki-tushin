<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>名人お品書き通信</title> <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
            margin: 0;
            padding: 20px;
        }
        .container {
            display: flex;
            max-width: 1000px;
            margin: 0 auto;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        header {
            text-align: center;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        #sidebar {
            width: 30%;
            border-right: 1px solid #eee;
            padding: 20px;
        }
        #sidebar ul {
            list-style: none;
            padding: 0;
        }
        #sidebar li a {
            text-decoration: none;
            color: #0366d6;
            display: block;
            padding: 10px;
            border-radius: 5px;
            transition: background-color 0.2s;
        }
        #sidebar li a:hover {
            background-color: #f1f1f1;
        }
        #content {
            width: 70%;
            padding: 20px 40px;
        }
        /* Markdown用のスタイル */
        #content h1, #content h2, #content h3 { border-bottom: 1px solid #eaecef; padding-bottom: .3em; }
        #content code { background-color: #f6f8fa; padding: .2em .4em; margin: 0; font-size: 85%; border-radius: 3px; }
        #content pre { background-color: #f6f8fa; padding: 16px; overflow: auto; border-radius: 3px; }
    </style>
</head>
<body>
    <header>
        <h1>☆名人お品書き通信☆</h1> </header>

    <div class="container">
        <aside id="sidebar">
            <h2>記事一覧</h2>
            <ul id="posts-list"></ul>
        </aside>
        <main id="content">
            <p>左のリストから記事を選択してください。</p>
        </main>
    </div>

    <script>
        // ★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★
        // ↓↓↓↓ ここをあなたの情報に書き換えてください ↓↓↓↓
        // ★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★

        const GITHUB_USERNAME = 'Emon2358';      // あなたのGitHubユーザー名
        const GITHUB_REPONAME = 'meijin-oshinagaki-tushin';         // このブログのリポジトリ名
        const POSTS_DIRECTORY = '_posts';             // 記事を保存しているディレクトリ名

        // ★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★
        // ↑↑↑↑ ここまでを書き換えてください ↑↑↑↑
        // ★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★

        const postsListElement = document.getElementById('posts-list');
        const contentElement = document.getElementById('content');

        /**
         * 記事一覧を取得してサイドバーに表示する関数
         */
        async function loadPostsList() {
            const apiUrl = `https://api.github.com/repos/${GITHUB_USERNAME}/${GITHUB_REPONAME}/contents/${POSTS_DIRECTORY}`;
            try {
                const response = await fetch(apiUrl);
                if (!response.ok) throw new Error('ネットワークの応答が正しくありませんでした。');
                const files = await response.json();

                postsListElement.innerHTML = ''; // リストをクリア
                for (const file of files) {
                    if (file.name.endsWith('.md')) {
                        const listItem = document.createElement('li');
                        const link = document.createElement('a');
                        link.href = `?post=${file.name}`;
                        link.textContent = file.name.replace(/\.md$/, ''); // .md拡張子を削除
                        
                        link.addEventListener('click', (event) => {
                            event.preventDefault(); // ページ遷移を防ぐ
                            window.history.pushState(null, '', `?post=${file.name}`);
                            loadPostContent(file.path);
                        });

                        listItem.appendChild(link);
                        postsListElement.appendChild(listItem);
                    }
                }
            } catch (error) {
                console.error('記事一覧の読み込みに失敗しました:', error);
                postsListElement.innerHTML = '<li>記事の読み込みに失敗しました。</li>';
            }
        }

        /**
         * 指定されたMarkdownファイルの内容を読み込んで表示する関数
         * @param {string} path - ファイルのパス
         */
        async function loadPostContent(path) {
            const apiUrl = `https://api.github.com/repos/${GITHUB_USERNAME}/${GITHUB_REPONAME}/contents/${path}`;
            try {
                contentElement.innerHTML = '<p>読み込み中...</p>';
                const response = await fetch(apiUrl);
                if (!response.ok) throw new Error('ネットワークの応答が正しくありませんでした。');
                const file = await response.json();

                // contentはBase64でエンコードされているのでデコードする
                const markdownContent = decodeURIComponent(escape(window.atob(file.content)));
                
                // marked.jsを使ってMarkdownをHTMLに変換して表示
                contentElement.innerHTML = marked.parse(markdownContent);

            } catch (error) {
                console.error('記事の読み込みに失敗しました:', error);
                contentElement.innerHTML = '<h2>記事の読み込みに失敗しました</h2>';
            }
        }
        
        /**
         * ページの初期化処理
         */
        function initialize() {
            loadPostsList();
            
            // URLのクエリパラメータをチェックして、指定された記事があれば読み込む
            const urlParams = new URLSearchParams(window.location.search);
            const postName = urlParams.get('post');
            if (postName) {
                loadPostContent(`${POSTS_DIRECTORY}/${postName}`);
            }
        }
        
        // ページが読み込まれたら初期化処理を実行
        initialize();
    </script>
</body>
</html>
